# üõ°Ô∏è nox ‚Äî An Intrusion Detection System

`nox` is a stateful Intrusion Detection System (IDS) engine written in Go from scratch. The purpose of this project is to explore and implement the core mechanics behind modern detection and response platforms, with a special focus on event correlation and attack chain analysis.

This project demonstrates how to build a security engine that can ingest, parse, and analyze log data to identify not just single suspicious events, but also the sequences of actions that indicate a sophisticated compromise.

## Features

- **Stateless Detection Engine:** Utilizes a flexible, YAML-based rule engine for high-speed pattern matching. Rules are mapped to the MITRE ATT&CK¬Æ Framework to provide industry-standard context for detections.

- **Stateful Anomaly Detection:** Employs Go-based rules to track state over time and detect anomalies that span multiple events, such as SSH brute-force attacks and rapid process execution bursts.

- **Event Correlation Engine:** The core of the engine. It connects seemingly disparate events and alerts to uncover multi-stage attack chains. It can detect sequences like:

  - A brute-force attack followed by a successful login and defense evasion.
  - A suspicious file download followed by its immediate execution.
  - The creation of a new user account followed by its immediate use.

- **IOC Matching:** Performs reputational checks by matching event indicators (like source IP addresses) against a configurable watchlist of known-bad Indicators of Compromise.
- **Multi-Format Log Ingestion:** The ingester tails log files and uses a registry of parsers to handle different formats, including sshd authentication logs and execsnoop-style process execution logs.

## How To Run

The entire environment is containerized and can be launched with **Docker Compose**.

1. **Start the Engine:** From the root of the nox project, run:

```
docker-compose up --build
```

2. **Generate Log Events:** In a seperate terminal, run the simulator. You can run it in two modes.

- **Chaos Mode (Default):** Generates a random mix of all supported log types

```
go run ./cmd/log-simulator/main.go
```

- **Targeted Test Case:** Generates a specific, deterministic attack chain to test a correlation rule.

```
# Test the Brute-Force & Defense Evasion correlation
go run ./cmd/log-simulator/main.go -testcase="bruteforce"

# Test the Download & Execute correlation
go run ./cmd/log-simulator/main.go -testcase="download"
```

3. **Observe Alerts:** Watch the logs from the `nox-1` container in the first terminal. You will see alerts being generated in real-time as teh simulator writes to the log file.

## Example Alert (Correlation)

Here is an example of a **CRITICAL** alert generated by the correlation engine, showing a confirmed attack chain.

```
{
    "time": "2025-09-08T11:45:00.123Z",
    "level": "ERROR",
    "msg": "Attack Chain Detected: A successful login from 198.51.100.99 after a brute-force was followed by the defense evasion command: 'history -c'",
    "rule_name": "CorrelatedBruteForceAndEvasion",
    "severity": "CRITICAL",
    "source": "198.51.100.99",
    "metadata": {
        "mitre_tactic": "TA0005",
        "correlated_events": "TooManyFailedLogins, SSHD_Accepted_Password, DefenseEvasionCommand",
        "source_ip": "198.51.100.99",
        "evasion_command": "history -c",
        "linked_sshd_pid": "2538"
    }
}
```
